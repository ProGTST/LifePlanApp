# スケジュール画面 仕様書

## 1. 画面基本情報

| 項目 | 内容 |
|------|------|
| 画面ID | schedule |
| 画面名 | スケジュール |
| URL | N/A（SPA。ビューID: `schedule`） |
| 対象ユーザー | ログイン済みの一般ユーザー。参照可能な勘定に紐づく取引のみ表示。 |
| 関連画面 | **遷移元**: フッター「スケジュール」、サイドバー「スケジュール」。**遷移先**: 収支記録（行クリックで編集）、他画面。検索条件は filterStateSchedule で保持（収支履歴・カレンダーとは別）。 |

---

## 2. 画面概要

- **目的**: 収支（予定・実績）を日単位・週単位・月単位のタイムラインで表示し、検索条件で絞り込む。行クリックで収支記録画面に遷移して編集できる。
- **業務上の位置付け**: 収支データのスケジュールビュー。カレンダーと同様に検索条件を別保持し、予定と実績を両方表示する（getFilteredTransactionListForSchedule）。
- **想定利用シナリオ**: 日/週/月の列でいつ何があるかを俯瞰し、クリックして詳細を編集する。

---

## 3. UI構成

### 3.1 画面レイアウト

| エリア | 内容 |
|--------|------|
| ヘッダー | タイトル「スケジュール」、データ最新化、検索条件リセット |
| 検索エリア | 収支履歴と同様の検索条件（予定/実績、種別、日付、カテゴリ、タグ、勘定、金額、フリーテキスト）。filterStateSchedule で保持 |
| 一覧エリア | 日/週/月の単位切替。日付列（日単位は日、週単位は週、月単位は月）と、各列に対応する取引リスト。選択月前後を表示するオプション（pastMonths, futureMonths） |
| 詳細エリア | 行クリックで収支記録画面へ遷移 |
| フッター | 共通ナビ |

### 3.2 入力項目定義（検索条件）

収支履歴画面の検索条件と同様（filterStatus, filterType, filterDateFrom, filterDateTo, filterCategoryIds, filterTagIds, filterAccountIds, filterAmountMin, filterAmountMax, filterFreeText）。スケジュールでは filterStatus は常に ["plan", "actual"] で固定（getFilteredTransactionListForSchedule で plan と actual の両方を使用）。

---

## 4. 操作仕様（イベント仕様）

| 操作 | 条件 | 処理内容 | 備考 |
|------|------|----------|------|
| 単位切替（日/週/月） | — | 列ヘッダーと列内容を再計算・再描画。日単位は日付列、週単位は週の開始日等、月単位は月でグループ | |
| 検索条件変更 | — | filterStateSchedule を更新し、表示を再描画。registerFilterChangeCallback で他コールバックも実行 | |
| 検索条件リセット | — | 条件をデフォルトに戻して再描画 | |
| 行クリック | — | 該当取引の ID を setTransactionEntryEditId にセットし、収支記録画面へ遷移 | |
| ナビ（前後） | — | 表示範囲の日付を前後にシフトして再描画 | |
| データ最新化 | — | loadTransactionData(true) のうえでスケジュールを再描画 | |

---

## 5. 業務ルール

- **表示対象**: 収支履歴と同様に、削除フラグ・勘定の参照権限・検索条件で絞り込んだ取引。予定と実績を両方表示（filterStatus は schedule 用で plan+actual 固定）。
- **日付範囲**: 日単位は 1 日ごとの列、週単位は週の開始日（日曜）ごと、月単位は月ごとの列。表示範囲は過去・未来の月数で制御。
- **ソート・集計**: 列ごとに該当する取引を日付範囲でフィルタして表示。取引は TRANDATE_FROM～TRANDATE_TO が列の範囲と重なるものを表示。

---

## 6. データ連携

### 6.1 API仕様

収支履歴画面と同様。GET /api/data/*.csv で TRANSACTION, CATEGORY, ACCOUNT, ACCOUNT_PERMISSION, TAG, TAG_MANAGEMENT 等を取得。本画面では CSV の更新は行わない。

### 6.2 DB定義（CSV 対応）

| 種別 | テーブル（ファイル） | 備考 |
|------|----------------------|------|
| 使用テーブル | TRANSACTION, CATEGORY, ACCOUNT, ACCOUNT_PERMISSION, TAG, TAG_MANAGEMENT 等 | 表示・検索のみ |
| 参照テーブル | 同上 | 更新対象なし |
| 更新対象 | なし | 収支記録画面で更新 |

---

## 7. 権限制御

- 収支履歴と同様。参照可能な勘定に紐づく取引のみ表示。行の権限（参照/編集）は getRowPermissionType で判定し、収支記録画面での編集可否に利用。

---

## 8. バリデーション仕様

- 検索条件の日付・金額は入力されていればフィルタに使用。不正値は無視。

---

## 9. エラー仕様

- 収支履歴と同様。CSV 取得失敗時は空表示。API エラーは未ハンドリング時はコンソール。

---

## 10. 非機能要件

| 項目 | 内容 |
|------|------|
| レスポンス目標 | 特になし |
| 同時接続数想定 | 特になし |
| ログ出力内容 | 特になし |
