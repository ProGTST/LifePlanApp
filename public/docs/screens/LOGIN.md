# ログイン画面 仕様書

## 1. 画面基本情報

| 項目 | 内容 |
|------|------|
| 画面ID | login-screen（定数 LOGIN_SCREEN_ID）。HTML は login.html の単一画面。 |
| 画面名 | ログイン |
| URL | login.html（ログイン前は sessionStorage に userId が無いため index.html ではなく login.html に遷移） |
| 対象ユーザー | 未ログインのユーザー。USER.csv に存在するユーザーID でログインする。 |
| 関連画面 | **遷移元**: アプリ起動時（sessionStorage に userId が無い場合に window.location で login.html を表示）。**遷移先**: ログイン成功後、showScreen(APP_SCREEN_ID) により index.html（アプリ画面）を表示。 |

---

## 2. 画面概要

- **目的**: ユーザーID を入力し、USER マスタに存在することを確認したうえでログインする。成功時は sessionStorage にユーザーID を保存し、アプリ画面（index.html）を表示する。
- **業務上の位置付け**: 認証の入口。パスワードは現状なく、ユーザーID の存在チェックのみ行う。
- **想定利用シナリオ**: アプリを開いたときにログイン画面が表示され、USER.csv に登録済みのユーザーID を入力して「ログイン」するとアプリ本体が表示される。

---

## 3. UI構成

### 3.1 画面レイアウト

| エリア | 内容 |
|--------|------|
| ヘッダー | ログイン画面用のタイトル等（login.html の構成に依存） |
| 検索エリア | なし |
| 一覧エリア | なし |
| 詳細エリア | ログインフォーム（ユーザーID 入力、送信ボタン）、エラーメッセージ表示（login-error） |
| フッター | 特になし（単体ページ） |

### 3.2 入力項目定義

| 項目名 | DB項目 | 型 | 必須 | 制約 | 備考 |
|--------|--------|-----|------|------|------|
| ユーザーID | USER.ID | 文字列 | ○ | USER に存在する ID | id="login-user"。placeholder「ユーザーIDを入力」。autocomplete="username" |

---

## 4. 操作仕様（イベント仕様）

| 操作 | 条件 | 処理内容 | 備考 |
|------|------|----------|------|
| フォーム submit | — | 1) ユーザーID をトリム。2) 空なら login-error に「ユーザーIDを入力してください。」を表示して終了。3) fetchUserIds() で USER.csv から ID 一覧を取得。4) 入力 ID が一覧に含まれていなければ login-error に「ユーザーが見つかりません。」を表示して終了。5) applyUserPalette(userId)、setCurrentUserId(userId)、setAccountListLoaded(false)、showScreen(APP_SCREEN_ID) を実行し、アプリ画面へ遷移 | パスワードチェックはなし |

---

## 5. 業務ルール

- **ログイン条件**: 入力されたユーザーID（前後空白除去）が、USER.csv の ID 列に存在すること。大文字小文字は区別する（取得した ID とそのまま比較）。
- **セッション保持**: ログイン成功時、ユーザーID を sessionStorage に保存（USER_ID_STORAGE_KEY）。index.html の DOMContentLoaded でこの値を参照し、無ければ login.html へリダイレクトする。
- **パスワード**: 現仕様ではパスワードは使用しない。ID の存在のみでログイン可能。

---

## 6. データ連携

### 6.1 API仕様

| メソッド | パス | 概要 |
|----------|------|------|
| GET | /api/data/USER.csv または /data/USER.csv | ユーザーID 一覧取得（fetchUserIds は fetchCsv("/data/USER.csv") を使用）。ヘッダーの ID 列の値を Set で返す |

※ ログイン画面は login.html 単体のため、API ベース URL が /api か /data かは実装に依存。fetchCsv は /data/USER.csv を指定しているため、Vite の配信またはプロキシで /data が解決される想定。

### 6.2 DB定義（CSV 対応）

| 種別 | テーブル（ファイル） | 備考 |
|------|----------------------|------|
| 使用テーブル | USER | ID 列のみ参照。存在チェック用 |
| 参照テーブル | USER | 同上 |
| 更新対象 | なし | ログイン画面では更新しない |

---

## 7. 権限制御

- 本画面は未認証の状態で表示される。ログイン成功後は「そのユーザーとして」アプリを利用する。管理者/一般の区別は現仕様では USER テーブルには持たず、勘定の参照権限（ACCOUNT_PERMISSION）で制御する。

---

## 8. バリデーション仕様

| 種別 | 内容 |
|------|------|
| 必須チェック | ユーザーID: 空は不可。「ユーザーIDを入力してください。」を表示 |
| 存在チェック | ユーザーID が USER.csv の ID に存在すること。「ユーザーが見つかりません。」を表示 |

---

## 9. エラー仕様

| 項目 | 内容 |
|------|------|
| 表示位置 | id="login-error"。aria-live="polite" でスクリーンリーダーに通知 |
| メッセージ内容 | 未入力: 「ユーザーIDを入力してください。」。存在しない: 「ユーザーが見つかりません。」 |
| HTTP ステータス | USER.csv 取得失敗時は fetchUserIds が空の Set を返すため、存在しない ID と同様に「ユーザーが見つかりません。」となる。明示的な HTTP エラー表示は特になし |

---

## 10. 非機能要件

| 項目 | 内容 |
|------|------|
| レスポンス目標 | 特になし。ログイン押下からアプリ表示までに USER.csv 取得とパレット適用が入る |
| 同時接続数想定 | 特になし |
| ログ出力内容 | 特になし |
