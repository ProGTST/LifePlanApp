# ホーム画面 仕様書

## 1. 画面基本情報

| 項目 | 内容 |
|------|------|
| 画面ID | home |
| 画面名 | ホーム |
| URL | N/A（SPA。アプリは index.html。初期表示ビューは home） |
| 対象ユーザー | ログイン済みの一般ユーザー全員 |
| 関連画面 | **遷移元**: アプリ起動時のデフォルト、フッター「ホーム」、サイドバー「ホーム」。**遷移先**: フッター・サイドバーから他画面へ。 |

---

## 2. 画面概要

- **目的**: アプリのトップ画面。ログインユーザーのプロフィールをヘッダーに表示し、勘定残高・今週/今月の予定・実績の集計とグラフで収支を把握する。
- **業務上の位置付け**: ダッシュボード的な入口。残高サマリ、予定進捗（ゲージ）、実績のカテゴリ別割合（円グラフ）、日別推移などを表示し、収支・スケジュール・マスタ等への導線を提供する。
- **想定利用シナリオ**: ログイン後に最初に表示される画面。個人・共有の残高、予定収入/支出の進捗、今週/今月の実績を確認し、フッターやサイドバーから目的の画面へ遷移する。

---

## 3. UI構成

### 3.1 画面レイアウト

| エリア | 内容 |
|--------|------|
| ヘッダー | メニューバー（タイトル「ホーム」、データ最新化）、プロフィール領域（アイコン、表示名）。他画面と共通。 |
| 検索エリア | なし |
| 一覧エリア | 勘定残高セクション（個人の総残高、共有の総残高、勘定ごとの残高）、予定収入/支出の進捗ゲージ、今週/今月の実績円グラフ（カテゴリ別）、日別推移グラフ。loadTransactionData で取引データを取得 |
| 詳細エリア | 上記セクションの表示（home-balance-content、home-summary-gauges、home-summary-pie-charts 等） |
| フッター | 共通ナビ（ホーム、カレンダー、スケジュール、収支履歴、収支記録、分析、メニュー、設定、戻る） |

### 3.2 入力項目定義

本画面は表示のみで入力フォームはない。ヘッダーのプロフィール表示は USER の NAME / COLOR / ICON_PATH を参照するが、本画面では編集しない（プロフィール画面で編集）。

---

## 4. 操作仕様（イベント仕様）

| 操作 | 条件 | 処理内容 | 備考 |
|------|------|----------|------|
| 画面表示 | ビューID が home | registerViewHandler("home") で loadTransactionData() 後に renderHeaderProfile、renderBalanceSection、今週/今月の集計・グラフを描画 | USER.csv と TRANSACTION 等を取得 |
| データ最新化 | ホーム表示中 | registerRefreshHandler("home") で loadTransactionData(true) により再取得し、全セクションを再描画 | renderHeaderProfile(true) で USER.csv 再取得 |

---

## 5. 業務ルール

- **表示対象**: ヘッダーは USER の currentUserId に一致する1行。残高・集計は loadTransactionData で取得した TRANSACTION, ACCOUNT, ACCOUNT_PERMISSION 等を使用。**個人の勘定**は USER_ID が自分と一致する勘定に紐づく取引のみ。**共有の勘定**は ACCOUNT_PERMISSION で付与された勘定。
- **更新は行わない**: 本画面では CSV の更新は行わない。プロフィール変更はプロフィール画面で行う。

---

## 6. データ連携

### 6.1 API仕様

| メソッド | パス | 概要 |
|----------|------|------|
| GET | /api/data/USER.csv | ヘッダー用にユーザー一覧取得。currentUserId に一致する行を表示に使用 |
| GET | /api/data/*.csv | loadTransactionData で TRANSACTION, ACCOUNT, ACCOUNT_PERMISSION, CATEGORY, TRANSACTION_MANAGEMENT 等を取得。残高・集計・グラフ描画に使用 |

### 6.2 DB定義（CSV 対応）

| 種別 | テーブル（ファイル） | 備考 |
|------|----------------------|------|
| 使用テーブル | USER | ヘッダー表示用。1行（currentUserId に一致）を参照 |
| 参照テーブル | USER | 同上 |
| 更新対象 | なし | 本画面では更新しない |

---

## 7. 権限制御

- ログイン済みユーザーのみが本画面に到達する（未ログイン時は login.html にリダイレクト）。表示内容は自分自身のプロフィールのみ。

---

## 8. バリデーション仕様

- 本画面は表示のみのため、入力バリデーションはなし。

---

## 9. エラー仕様

| 項目 | 内容 |
|------|------|
| 表示位置 | USER.csv 取得失敗時はヘッダーを空またはフォールバック表示。エラー表示は特になし |
| メッセージ内容 | 特になし |
| HTTP ステータス | GET が 200 以外のとき fetchCsv は空を返す想定 |

---

## 10. 非機能要件

| 項目 | 内容 |
|------|------|
| レスポンス目標 | 特になし |
| 同時接続数想定 | 特になし |
| ログ出力内容 | 特になし |
